// Generated by CoffeeScript 1.10.0
(function() {
  'use strict';
  define(['text!/Pages/device/add_set.html', 'avalon', 'api', 'page', 'avalon.cookie', 'select2'], function(pageMain, avalon, api, page) {
    var vm;
    avalon.templateCache.device_add_set = pageMain;
    vm = avalon.define({
      $id: 'device_add_set',
      title: '添加影片集',
      mod: avalon.vmodels.dashboard.mod,
      host: avalon.vmodels.dashboard.host,
      uid: avalon.vmodels.dashboard.uid,
      url: null,
      isLoading: false,
      deviceId: null,
      loading: '/Assets/logic/common/loading.html',
      setting: {},
      getPlaySetting: function() {
        return api.getApi('/setting/getPlaySetting', {
          'uid': vm.deviceId
        }, function(result) {
          if (SUCCESS === result.code) {
            return vm.setting = result.item;
          } else {
            return require(['logic/common/tips'], function(tips) {
              return tips.showTips(result.msg, 'error');
            });
          }
        });
      },
      s_platform: null,
      link: '',
      addSet: function() {
        if (null === vm.s_platform) {
          require(['logic/common/tips'], function(tips) {
            return tips.showTips('必须选择一个平台', 'error');
          });
        }
        if ('' === vm.link) {
          require(['logic/common/tips'], function(tips) {
            return tips.showTips('必须填写格式正确的影片集链接', 'error');
          });
        }
        return api.getApi('/task/add_set', {
          'platform': vm.s_platform,
          'link': vm.link,
          'deviceId': vm.deviceId
        }, function(result) {
          if (SUCCESS === result.code) {
            return require(['logic/common/tips'], function(tips) {
              return tips.showTips(result.msg, 'success', {
                'redirectUrl': '#!/task:home'
              });
            });
          } else {
            return require(['logic/common/tips'], function(tips) {
              return tips.showTips(result.msg, 'error');
            });
          }
        });
      },
      init: function(url) {
        avalon.log('device add_set page load complete');
        vm.url = url;
        vm.currentPage = vm.url.page ? vm.url.page : 1;
        vm.deviceId = vm.url.deviceId ? vm.url.deviceId : _clientInfo['uid'];
        vm.s_platform = null;
        vm.link = '';
        return vm.getPlaySetting();
      }
    });
    return vm;
  });

}).call(this);

//# sourceMappingURL=add_set.js.map
