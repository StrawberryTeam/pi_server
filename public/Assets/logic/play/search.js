// Generated by CoffeeScript 1.12.7
(function() {
  'use strict';
  var indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  define(['text!/Pages/play/search.html', 'avalon', 'api', 'page', 'avalon.cookie', 'select2'], function(pageMain, avalon, api, page) {
    var vm;
    avalon.templateCache.play_search = pageMain;
    vm = avalon.define({
      $id: 'search',
      title: '',
      mod: avalon.vmodels.play.mod,
      host: avalon.vmodels.play.host,
      service: avalon.vmodels.play.service,
      url: null,
      loading: '/Assets/logic/common/loading.html',
      oneColumn: 11,
      count: 0,
      letterKeyboards: ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'ü', 'w', 'x', 'y', 'z', '删除', '数/英文'],
      numberKeyboards: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '删除', '拼音'],
      keyboards: [],
      bg_colors: ['#9f5f9f', '#a67d3d', '#42426f', '#4c82b2', '#0f7a75', '#963b3a'],
      rand_bg: function(img, platform) {
        if (1 === platform) {
          return 'url(' + vm.host + img + ')';
        } else {
          return 'url(' + img + ')';
        }
      },
      rand_bgcolor: function() {
        var index;
        index = parseInt(Math.random() * 6) + 1;
        return vm.bg_colors[index - 1];
      },
      set_bg: function(img, platform) {
        if (indexOf.call(NOTSHOWIMG_PLATFORM, platform) >= 0) {
          return '/index/show_pic?p=' + img;
        } else {
          return img;
        }
      },
      key: '',
      query: '',
      clearQuery: function() {
        return vm.query = '';
      },
      searchQuery: function(e) {
        e.preventDefault();
        if (vm.query === '') {
          return false;
        }
        vm.key = '';
        vm.keyType = 2;
        return vm.getList();
      },
      type: 'all',
      changeType: function(type) {
        vm.type = type;
        return vm.getList();
      },
      keyType: 1,
      clickKey: function(key) {
        vm.query = '';
        if ('删除' === key) {
          vm.key = vm.key.substring(0, vm.key.length - 1);
          vm.getList();
        } else if ('数/英文' === key) {
          vm.key = '';
          vm.keyboards = vm.numberKeyboards;
          vm.keyType = 2;
          vm.focusKey();
        } else if ('拼音' === key) {
          vm.key = '';
          vm.keyboards = vm.letterKeyboards;
          vm.keyType = 1;
          vm.focusKey();
        } else {
          vm.key += key;
          vm.getList();
        }
        return avalon.log(vm.key);
      },
      error: '',
      emptyList: function(status) {
        if (status == null) {
          status = [];
        }
        vm.error = status;
        vm.list1 = [];
        vm.list2 = [];
        vm.list3 = [];
        return vm.info = {};
      },
      list1: [],
      list2: [],
      list3: [],
      info: {},
      getList: function() {
        var query;
        if (vm.key === '' && vm.query === '') {
          vm.emptyList();
          return false;
        }
        if (vm.query) {
          query = vm.query;
        } else {
          query = vm.key.replace('ü', 'v');
        }
        vm.emptyList('loading');
        return api.getApi('/search/get_list', {
          'count': vm.count,
          'keyword': query,
          'keytype': vm.keyType,
          'type': vm.type
        }, function(result) {
          if (SUCCESS === result.code) {
            vm.emptyList();
            vm.list1 = result.list.splice(0, vm.oneColumn) || [];
            vm.list2 = result.list.splice(0, vm.oneColumn) || [];
            return vm.list3 = result.list.splice(0, vm.oneColumn) || [];
          } else if (ISEMPTY === result.code) {
            return vm.emptyList(false);
          } else {
            return require(['logic/common/tips'], function(tips) {
              return tips.showTips(result.msg, 'error');
            });
          }
        });
      },
      focusKey: function() {
        return setTimeout(function() {
          return $("#FocusMovie0").focus();
        }, 200);
      },
      init: function(url) {
        avalon.log('search page load complete');
        vm.url = url;
        vm.key = '';
        vm.keyboards = vm.letterKeyboards;
        vm.count = vm.oneColumn * 3;
        vm.keyType = 1;
        vm.type = 'all';
        vm.query = '';
        vm.emptyList(null);
        vm.focusKey();
        avalon.vmodels.play.title = '';
        return document.title = avalon.vmodels.play.title;
      }
    });
    return vm;
  });

}).call(this);

//# sourceMappingURL=search.js.map
